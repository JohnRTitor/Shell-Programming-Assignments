name: Check Kebab Case Naming Convention

on:
  push:
    paths:
      - '**/*'

jobs:
  check-kebab-case:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get Commit Hashes
        run: |
          base_commit=$(git rev-parse HEAD~1)
          current_commit=$(git rev-parse HEAD)

          non_conforming_files=$(git diff --name-only $base_commit $current_commit | grep -E -v '/\..*|/\.|[^/]+/[^/]+\.sh$' | grep -E '^[a-z]+(-[a-z]+)*\.sh$'  )

          if [ -n "$non_conforming_files" ]; then
            echo "Files with non-conforming names:"
            echo "$non_conforming_files" | awk '{print $0 "\n" "File Path: " ENVIRON["GITHUB_WORKSPACE"] "/" $0}'
            exit 1
          else
            echo "All modified or created .sh files follow the kebab case convention."
          fi
